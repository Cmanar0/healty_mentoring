{% extends "dashboard_mentor/base.html" %}
{% load static %}

{% block page_title %}Session History{% endblock %}

{% block dashboard_content %}
<div class="dashboard-content-container">
  <div class="dashboard-card flex-scroll-card">
    <div class="card-header" style="align-items: center;">
      <h3 class="card-title">Session History</h3>
      <a href="{% url 'general:dashboard_mentor:my_sessions' %}" class="session-history-back-btn">
        <i class="fas fa-arrow-left"></i>
        <span>Back to Upcoming sessions</span>
      </a>
    </div>

    <div class="session-timeline-container scrollable-content" id="sessionHistoryContainer">
      {% if past_sessions %}
        {% for session in past_sessions %}
          <div class="session-item session-item--past status-{{ session.status }}" data-session-id="{{ session.id }}">
            <div class="session-left">
              <div class="session-date">
                <span class="date-day">{{ session.start_datetime|date:"d" }}</span>
                <span class="date-month">{{ session.start_datetime|date:"M" }}</span>
              </div>
              <div class="session-info">
                <h4 class="session-title">Session with {{ session.client_name }}{% if session.is_first_session %} <span class="first-session-tag">1st</span>{% endif %}</h4>
                <div class="session-meta-row">
                  <span class="session-time">
                    <i class="far fa-clock"></i> {{ session.start_datetime|date:"g:i A" }} - {{ session.end_datetime|date:"g:i A" }}
                  </span>
                  <span class="conf-tag status-{{ session.status }}" style="
                    {% if session.status == 'completed' %}background: rgba(16, 185, 129, 0.1); color: #059669;
                    {% elif session.status == 'confirmed' %}background: rgba(34, 197, 94, 0.1); color: #16a34a;
                    {% elif session.status == 'invited' %}background: rgba(251, 191, 36, 0.1); color: #f59e0b;
                    {% elif session.status == 'refunded' %}background: rgba(239, 68, 68, 0.1); color: #dc2626;
                    {% elif session.status == 'expired' %}background: rgba(107, 114, 128, 0.1); color: #6b7280;
                    {% else %}background: #f1f5f9; color: #64748b;{% endif %}
                  ">
                    {{ session.status|default:"Past"|title }}
                  </span>
                </div>
              </div>
            </div>
            <div class="session-right">
              <button type="button" class="session-history-view-details" onclick="if (typeof openSessionDetailModal === 'function') openSessionDetailModal({{ session.id }});">
                <i class="fas fa-info-circle"></i> View Details
              </button>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <div class="session-item" style="border-left: none; padding: 16px; text-align: center; color: var(--dash-text-muted);">
          <p>No past sessions yet</p>
        </div>
      {% endif %}
    </div>
  </div>
</div>

<style>
  .session-history-back-btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 16px;
    background: #f1f5f9;
    color: var(--dash-text-main);
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    font-weight: 500;
    text-decoration: none;
    transition: background 0.2s, border-color 0.2s;
  }
  .session-history-back-btn:hover {
    background: #e2e8f0;
    border-color: #cbd5e1;
    color: var(--dash-text-main);
  }
  .session-item--past .session-left { cursor: default; }
  .session-history-view-details {
    background: transparent;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    padding: 8px 14px;
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--dash-primary);
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    transition: background 0.2s, border-color 0.2s;
  }
  .session-history-view-details:hover {
    background: rgba(16, 185, 129, 0.08);
    border-color: var(--dash-primary);
  }
  .first-session-tag {
    display: inline-block;
    background: #ef4444;
    color: #ffffff;
    font-size: 10px;
    font-weight: 700;
    padding: 2px 5px;
    border-radius: 3px;
    margin-left: 6px;
    line-height: 1.2;
    vertical-align: middle;
  }
</style>
{% endblock %}
