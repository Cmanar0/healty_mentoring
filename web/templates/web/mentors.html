{% extends "base.html" %}
{% block title %}Find Your Mentor — Healthy Mentoring{% endblock %}
{% load static %}

{% block content %}
<!-- Mentors Page Header -->
<section class="mentors-page-header">
  <div class="container text-center">
    <h1>Browse Mentors</h1>
    <p>Connect with world-class experts to accelerate your growth.</p>
  </div>
</section>

<!-- Search Section (Reused & Adapted) -->
<section id="search" class="search-section-new mentors-page-search">
  <div class="search-header">
    <div class="search-bar-container">
      <div class="search-bar" style="position: relative;">
        <i class="fas fa-search"></i>
        <input type="text" id="searchInput" placeholder="Search for mentors by name..." autocomplete="off">
        <button class="clear-btn" id="clearBtn" style="display: none;">
          <i class="fas fa-times"></i>
        </button>
        <button class="search-btn">Search</button>
        <!-- Mentor suggestions dropdown -->
        <div class="autocomplete-suggestions" id="mentorSuggestions" style="position: absolute; top: 100%; left: 0; right: 0; z-index: 1000; display: none;"></div>
      </div>
    </div>
  </div>
  
  <div class="search-filters">
    <div class="filter-group">
      <label><i class="fas fa-tag"></i> Category</label>
      <div class="autocomplete-container" style="position: relative;">
        <input type="text" id="categoryInput" class="autocomplete-input" placeholder="Select a category..." autocomplete="off" value="{% if current_filters.category %}{% for cat in predefined_categories %}{% if cat.id == current_filters.category %}{{ cat.name }}{% endif %}{% endfor %}{% endif %}">
        <div class="autocomplete-suggestions" id="categorySuggestions"></div>
        <input type="hidden" id="categoryValue" value="{{ current_filters.category }}">
      </div>
    </div>
    
    <div class="filter-group">
      <label class="price-label">
        <span><i class="fas fa-dollar-sign" style="margin-right: 5px;"></i> Session Price</span>
        <span class="price-value" id="priceValue">$0 - ${{ max_price|default:200 }}</span>
      </label>
      <input type="range" min="{{ min_price|default:0 }}" max="{{ max_price|default:200 }}" value="{% if current_filters.price %}{{ current_filters.price }}{% else %}{{ max_price|default:200 }}{% endif %}" class="price-slider" id="priceSlider">
    </div>
    
    <div class="filter-group">
      <label><i class="fas fa-globe"></i> Language</label>
      <div class="autocomplete-container" style="position: relative;">
        <input type="text" id="languageInput" class="autocomplete-input" placeholder="Select a language..." autocomplete="off" value="{% if current_filters.language %}{% for lang in predefined_languages %}{% if lang.id == current_filters.language %}{{ lang.name }}{% endif %}{% endfor %}{% endif %}">
        <div class="autocomplete-suggestions" id="languageSuggestions"></div>
        <input type="hidden" id="languageValue" value="{{ current_filters.language }}">
      </div>
    </div>
    
    <div class="filter-group">
      <label><i class="fas fa-gift"></i> First Session Free</label>
      <div style="display: flex; align-items: center; margin-top: 8px;">
        <label class="toggle-switch" style="margin: 0;">
          <input type="checkbox" id="firstSessionFree" {% if current_filters.first_session_free %}checked{% endif %}>
          <span class="toggle-slider"></span>
        </label>
        <span style="margin-left: 8px; font-size: 0.9rem; color: var(--text-light);">Show only mentors offering free first session</span>
      </div>
    </div>
    
    <div class="filter-group">
      <label><i class="fas fa-clock"></i> Time Zone</label>
      <div style="display: flex; gap: 8px; align-items: center; margin-top: 8px;">
        <div class="autocomplete-container" style="position: relative; flex: 1;">
          <input type="text" id="timezoneMinInput" class="autocomplete-input" placeholder="Min timezone..." autocomplete="off" value="{% if current_filters.timezone_min %}{% for tz in common_timezones %}{% if tz.id == current_filters.timezone_min %}{{ tz.name }}{% endif %}{% endfor %}{% endif %}">
          <div class="autocomplete-suggestions" id="timezoneMinSuggestions"></div>
          <input type="hidden" id="timezoneMinValue" value="{{ current_filters.timezone_min }}">
        </div>
        <span style="color: var(--text-light);">to</span>
        <div class="autocomplete-container" style="position: relative; flex: 1;">
          <input type="text" id="timezoneMaxInput" class="autocomplete-input" placeholder="Max timezone..." autocomplete="off" value="{% if current_filters.timezone_max %}{% for tz in common_timezones %}{% if tz.id == current_filters.timezone_max %}{{ tz.name }}{% endif %}{% endfor %}{% endif %}">
          <div class="autocomplete-suggestions" id="timezoneMaxSuggestions"></div>
          <input type="hidden" id="timezoneMaxValue" value="{{ current_filters.timezone_max }}">
        </div>
        <button type="button" id="timezoneRangePlus" class="timezone-range-btn" title="Expand range">+</button>
        <button type="button" id="timezoneRangeMinus" class="timezone-range-btn" title="Narrow range">-</button>
      </div>
    </div>
  </div>
  
  <div class="mentors-container list-view" id="mentorsContainer">
    {% if mentors %}
      {% for mentor in mentors %}
      <div class="mentor-card" data-aos="fade-up" data-mentor-id="{{ mentor.user.id }}">
        <div class="mentor-header-content">
          <div class="mentor-avatar">
            {% if mentor.profile_picture %}
              <img src="{{ mentor.profile_picture.url }}" alt="{{ mentor.first_name }} {{ mentor.last_name }}">
            {% else %}
              <img src="https://i.pravatar.cc/150?img={{ mentor.user.id }}" alt="{{ mentor.first_name }} {{ mentor.last_name }}">
            {% endif %}
          </div>
          <div class="mentor-title">
            <h4>{{ mentor.first_name }} {{ mentor.last_name }}</h4>
            <p class="mentor-specialty">{{ mentor.mentor_type|default:"Mentor" }}</p>
          </div>
        </div>
        
        <div class="mentor-details">
          {% if mentor.quote %}
            <p class="mentor-motto">"{{ mentor.quote }}"</p>
          {% endif %}
          {% if mentor.bio %}
            <p class="mentor-bio">{{ mentor.bio|truncatewords:30 }}</p>
          {% endif %}
          {% if mentor.tags %}
            <div class="mentor-tags">
              {% for tag in mentor.tags|slice:":5" %}
                <span class="mentor-tag">{{ tag }}</span>
              {% endfor %}
            </div>
          {% endif %}
        </div>
        
        <div class="mentor-footer">
          {% if mentor.price_per_hour %}
            <p class="mentor-price">${{ mentor.price_per_hour|floatformat:0 }}<span>/session</span></p>
          {% else %}
            <p class="mentor-price">Contact<span> for pricing</span></p>
          {% endif %}
          <a href="{% url 'web:mentor_profile_detail' mentor.user.id %}" class="btn-mentor">View Profile</a>
        </div>
      </div>
      {% endfor %}
    {% else %}
      <div style="grid-column: 1 / -1; text-align: center; padding: 60px 20px;">
        <p style="font-size: 1.1rem; color: var(--text-light);">No mentors found matching your criteria.</p>
        <p style="font-size: 0.9rem; color: var(--text-light); margin-top: 8px;">Try adjusting your filters.</p>
      </div>
    {% endif %}
  </div>
  
  <!-- Loading indicator for infinite scroll -->
  <div id="mentorsLoading" style="display: none; text-align: center; padding: 40px 20px;">
    <div style="display: inline-block; width: 40px; height: 40px; border: 4px solid #e2e8f0; border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite;"></div>
    <p style="margin-top: 16px; color: var(--text-light);">Loading more mentors...</p>
  </div>
  
  <!-- No more mentors message -->
  <div id="mentorsEnd" style="display: none; text-align: center; padding: 40px 20px;">
    <p style="color: var(--text-light);">No more mentors to load.</p>
  </div>
  
  <style>
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</section>

<!-- Footer -->
<footer class="site-footer">
  <div class="container">
    <div class="footer-grid">
      <div class="footer-brand">
        <h3>Healthy Mentoring</h3>
        <p>A data-driven platform with a holistic approach—real human connection, powered by AI.</p>
        <div class="social-links">
          <a href="#"><i class="fab fa-twitter"></i></a>
          <a href="#"><i class="fab fa-linkedin"></i></a>
          <a href="#"><i class="fab fa-instagram"></i></a>
        </div>
      </div>
      <div class="footer-links">
        <h4>Platform</h4>
        <a href="{% url 'web:mentors' %}">Mentors</a>
        <a href="/#business-lab">Business Lab</a>
        <a href="#">Pricing</a>
      </div>
      <div class="footer-links">
        <h4>Company</h4>
        <a href="#">About</a>
        <a href="#">Careers</a>
        <a href="#" id="contact-link">Contact</a>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; {% now "Y" %} Healthy Mentoring. All rights reserved.</p>
    </div>
  </div>
</footer>
{% endblock %}

{% block scripts %}
<script src="{% static 'js/landing.js' %}"></script>
<script src="{% static 'js/search-interactions.js' %}"></script>

<!-- Predefined data for filters -->
{{ predefined_categories|json_script:"predefinedCategoriesData" }}
{{ predefined_languages|json_script:"predefinedLanguagesData" }}
{{ common_timezones|json_script:"commonTimezonesData" }}
{{ current_page|json_script:"currentPageData" }}
{{ has_next|json_script:"hasNextData" }}

<script src="{% static 'js/mentors-search.js' %}"></script>
<script data-search-url="{% url 'web:mentor_search_suggestions' %}" data-load-more-url="{% url 'web:mentors_load_more' %}">
  // URLs are set via data attributes on this script tag
</script>
{% endblock %}
