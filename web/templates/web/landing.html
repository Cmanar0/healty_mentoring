{% extends "base.html" %}
{% block title %}Healthy Mentoring â€” Mentors platform{% endblock %}
{% load static %}

{% block extra_css %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'css/landing.css' %}">
<!-- Flag Icons CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flag-icons@7.0.0/css/flag-icons.min.css">
{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section">
  <div class="container hero-container">
    <div class="hero-text" data-aos="fade-right">
      <span class="badge">Mentor Marketplace</span>
      <h1>Find Your Perfect Mentor.<br><span class="gradient-text">Achieve Your Goals.</span></h1>
      <p>A marketplace where you can find mentors to help you achieve your goals. Create projects, build plans, and get guidance from one or multiple mentorsâ€”whether you need long-term support or a simple one-time feedback session. Join communities to seek advice and network around topics you're passionate about.</p>
      <div class="hero-actions">
        <a href="#search" class="btn btn-primary">Find a Mentor</a>
        <a href="#how-it-works" class="btn btn-outline">How It Works</a>
      </div>
      <div class="hero-stats">
        <div class="stat">
          <span class="stat-number">500+</span>
          <span class="stat-label">Expert Mentors</span>
        </div>
        <div class="stat">
          <span class="stat-number">1000+</span>
          <span class="stat-label">Active Projects</span>
        </div>
      </div>
    </div>
    <div class="hero-visual" data-aos="fade-left">
      <div class="abstract-shape"></div>
      <div class="glass-card">
        <div class="card-header">
          <div class="avatar"></div>
          <div class="info">
            <div class="name">Your Journey</div>
            <div class="status">In Progress ðŸš€</div>
          </div>
        </div>
        <div class="chart-preview">
          <!-- Placeholder for mini chart or visual -->
          <div class="bar" style="height: 40%"></div>
          <div class="bar" style="height: 70%"></div>
          <div class="bar" style="height: 55%"></div>
          <div class="bar active" style="height: 90%"></div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Mentor Search Section -->
<section id="search" class="search-section-new">
  <div class="search-header">
    <h2 class="search-title">Find Your Perfect Mentor</h2>
    <p class="search-subtitle">Browse our curated network of expert mentors across all life areas</p>
    <div class="search-bar-container">
      <div class="search-bar" style="position: relative;">
        <i class="fas fa-search"></i>
        <input type="text" id="searchInput" placeholder="Search for mentors by name, expertise, or keyword..." autocomplete="off">
        <button class="clear-btn" id="clearBtn" style="display: none;">
          <i class="fas fa-times"></i>
        </button>
        <button class="search-btn">Search</button>
        <!-- Mentor suggestions dropdown -->
        <div class="autocomplete-suggestions" id="mentorSuggestions" style="position: absolute; top: 100%; left: 0; right: 0; z-index: 1000; display: none;"></div>
      </div>
    </div>
  </div>
  
  <div class="search-filters">
    <div class="filter-group filter-group-compact">
      <label><i class="fas fa-tag"></i> Category</label>
      <div class="autocomplete-container" style="position: relative;">
        <input type="text" id="categoryInput" class="form-input autocomplete-input" placeholder="Type to search categories..." autocomplete="off">
        <div class="autocomplete-suggestions" id="categorySuggestions"></div>
        <input type="hidden" id="categoryValue">
      </div>
    </div>
    
    <div class="filter-group price-slider-group">
      <label class="price-label">
        <span><i class="fas fa-dollar-sign" style="margin-right: 5px;"></i> Session Price</span>
        <span class="price-value" id="priceValue">$0 - ${{ max_price|default:200 }}</span>
      </label>
      <div class="price-slider-wrapper">
        <input type="range" min="{{ min_price|default:0 }}" max="{{ max_price|default:200 }}" value="{{ max_price|default:200 }}" class="price-slider" id="priceSlider">
      </div>
    </div>
    
    <div class="filter-group filter-group-compact">
      <label><i class="fas fa-globe"></i> Language</label>
      <div class="autocomplete-container" style="position: relative;">
        <input type="text" id="languageInput" class="form-input autocomplete-input" placeholder="Type to search languages..." autocomplete="off">
        <div class="autocomplete-suggestions" id="languageSuggestions"></div>
        <input type="hidden" id="languageValue">
      </div>
    </div>
    
    <div class="filter-group filter-group-compact">
      <label>
        <i class="fas fa-gift"></i> First Session Free
        <span class="info-icon-popover-trigger" data-popover="firstSessionFreePopover">
          <i class="fas fa-info-circle" style="color: var(--text-light); font-size: 0.85rem; margin-left: 4px; cursor: help;"></i>
        </span>
        <div class="info-popover" id="firstSessionFreePopover" style="display: none;">
          Show only mentors offering free first session
        </div>
      </label>
      <div style="display: flex; align-items: center; gap: 12px; margin-top: 8px;">
        <div class="toggle-wrapper">
          <label class="toggle-switch">
            <input type="checkbox" id="firstSessionFree">
            <span class="toggle-slider"></span>
          </label>
          <span class="toggle-status-text" id="firstSessionStatusText">Disabled</span>
        </div>
      </div>
    </div>
  </div>
  
  <div class="mentors-container" id="mentorsContainer">
    <!-- Mentor cards will be loaded dynamically -->
  </div>
  
  <div class="text-center" style="margin-top: 40px; padding: 0 20px;">
    <a href="#" id="seeMoreMentorsBtnLanding" class="btn btn-primary btn-lg" style="background-color: #3b82f6; padding: 16px 30px;">See More Mentors <i class="fas fa-arrow-right ml-2"></i></a>
  </div>

</section>

<!-- How It Works (The Journey) -->
<section id="how-it-works" class="journey-section">
  <div class="container">
    <div class="section-header text-center" data-aos="fade-up">
      <span class="badge">How It Works</span>
      <h2>Your Path to Success</h2>
      <p>From finding your mentor to achieving your goalsâ€”a simple, flexible process designed for you.</p>
    </div>
    
    <div class="path-to-success-grid">
      <!-- Step 1 -->
      <div class="path-step" data-aos="fade-up" data-aos-delay="0">
        <div class="path-step-number">1</div>
        <div class="path-step-icon"><i class="fas fa-search"></i></div>
        <h3 class="path-step-title">Find Your Perfect Mentor</h3>
        <p class="path-step-description">Browse our marketplace and filter by specialization, language, and price.</p>
      </div>

      <!-- Step 2 -->
      <div class="path-step" data-aos="fade-up" data-aos-delay="100">
        <div class="path-step-number">2</div>
        <div class="path-step-icon"><i class="fas fa-project-diagram"></i></div>
        <h3 class="path-step-title">Create Your Project</h3>
        <p class="path-step-description">Define your goals and build a plan for career growth or skill development.</p>
      </div>

      <!-- Step 3 -->
      <div class="path-step" data-aos="fade-up" data-aos-delay="200">
        <div class="path-step-number">3</div>
        <div class="path-step-icon"><i class="fas fa-calendar-check"></i></div>
        <h3 class="path-step-title">Book Your Session</h3>
        <p class="path-step-description">Schedule one-time feedback or commit to long-term guidance.</p>
      </div>

      <!-- Step 4 -->
      <div class="path-step" data-aos="fade-up" data-aos-delay="300">
        <div class="path-step-number">4</div>
        <div class="path-step-icon"><i class="fas fa-users"></i></div>
        <h3 class="path-step-title">Work with Multiple Mentors</h3>
        <p class="path-step-description">Get different expertise from multiple mentors simultaneously.</p>
      </div>

      <!-- Step 5 -->
      <div class="path-step" data-aos="fade-up" data-aos-delay="400">
        <div class="path-step-number">5</div>
        <div class="path-step-icon"><i class="fas fa-comments"></i></div>
        <h3 class="path-step-title">Join Communities</h3>
        <p class="path-step-description">Connect with like-minded people and network around topics you're passionate about.</p>
      </div>

      <!-- Step 6 -->
      <div class="path-step" data-aos="fade-up" data-aos-delay="500">
        <div class="path-step-number">6</div>
        <div class="path-step-icon"><i class="fas fa-chart-line"></i></div>
        <h3 class="path-step-title">Track Your Progress</h3>
        <p class="path-step-description">Monitor your projects and see your growth over time.</p>
      </div>
    </div>

    <div class="text-center mt-5" data-aos="fade-up">
      <a href="{% url 'web:mentors' %}" id="seeMoreMentorsBtn" class="btn btn-primary btn-lg" style="padding: 16px 30px;">Find your mentor <i class="fas fa-arrow-right ml-2"></i></a>
    </div>
  </div>
</section>

<!-- Projects & Plans Section -->
<section id="projects-plans" class="features-section">
  <div class="container">
    <div class="section-header text-center" data-aos="fade-up">
      <span class="badge">Projects & Plans</span>
      <h2>Turn Your Goals Into Action</h2>
      <p>Create structured projects and build actionable plans with the guidance of expert mentors.</p>
    </div>
    
    <div class="features-grid">
      <div class="feature-card" data-aos="fade-up" data-aos-delay="100">
        <div class="feature-icon"><i class="fas fa-project-diagram"></i></div>
        <h3>Create Projects</h3>
        <p>Define what you want to achieve. Break down big goals into manageable projects with clear milestones and timelines.</p>
      </div>
      
      <div class="feature-card" data-aos="fade-up" data-aos-delay="200">
        <div class="feature-icon"><i class="fas fa-tasks"></i></div>
        <h3>Build Action Plans</h3>
        <p>Work with your mentor to create detailed plans. Set tasks, track progress, and adjust as you learn and grow.</p>
      </div>
      
      <div class="feature-card" data-aos="fade-up" data-aos-delay="300">
        <div class="feature-icon"><i class="fas fa-user-check"></i></div>
        <h3>Get Expert Guidance</h3>
        <p>Receive personalized feedback and guidance from mentors who understand your goals and can help you stay on track.</p>
      </div>
    </div>
  </div>
</section>

<!-- Multiple Mentors Section -->
<section id="multiple-mentors" class="mentors-section">
  <div class="container">
    <div class="section-header text-center" data-aos="fade-up">
      <span class="badge">Flexible Mentoring</span>
      <h2>Work with One or Multiple Mentors</h2>
      <p>Choose the support structure that works best for youâ€”long-term guidance or quick feedback sessions.</p>
    </div>
    
    <div class="mentors-comparison">
      <div class="mentor-option" data-aos="fade-right">
        <div class="option-icon"><i class="fas fa-user-tie"></i></div>
        <h3>Single Mentor</h3>
        <p>Build a deep, long-term relationship with one mentor who understands your complete journey and provides consistent guidance.</p>
        <ul class="option-features">
          <li><i class="fas fa-check"></i> Consistent support</li>
          <li><i class="fas fa-check"></i> Deep understanding</li>
          <li><i class="fas fa-check"></i> Long-term growth</li>
        </ul>
      </div>
      
      <div class="mentor-option" data-aos="fade-left">
        <div class="option-icon"><i class="fas fa-users"></i></div>
        <h3>Multiple Mentors</h3>
        <p>Work with different mentors for different aspects of your goals. Get specialized expertise where you need it most.</p>
        <ul class="option-features">
          <li><i class="fas fa-check"></i> Diverse perspectives</li>
          <li><i class="fas fa-check"></i> Specialized expertise</li>
          <li><i class="fas fa-check"></i> Flexible support</li>
        </ul>
      </div>
    </div>
    
    <div class="session-types" data-aos="fade-up">
      <div class="session-type">
        <i class="fas fa-calendar-alt"></i>
        <h4>Long-Term Guidance</h4>
        <p>Ongoing support to help you achieve your goals over time</p>
      </div>
      <div class="session-type">
        <i class="fas fa-comment-dots"></i>
        <h4>One-Time Feedback</h4>
        <p>Quick sessions to get expert input on specific questions or challenges</p>
      </div>
    </div>
  </div>
</section>

<!-- Communities Section -->
<section id="communities" class="communities-section">
  <div class="container">
    <div class="section-header text-center" data-aos="fade-up">
      <span class="badge">Communities</span>
      <h2>Connect, Learn, and Network</h2>
      <p>Join topic-based communities to seek advice, share experiences, and connect with people who share your interests.</p>
    </div>
    
    <div class="communities-grid">
      <div class="community-card" data-aos="fade-up" data-aos-delay="100">
        <div class="community-icon"><i class="fas fa-lightbulb"></i></div>
        <h3>Seek Advice</h3>
        <p>Ask questions and get insights from community members and mentors who have experience in your area of interest.</p>
      </div>
      
      <div class="community-card" data-aos="fade-up" data-aos-delay="200">
        <div class="community-icon"><i class="fas fa-share-alt"></i></div>
        <h3>Share Experiences</h3>
        <p>Learn from others' journeys and share your own experiences to help fellow community members grow.</p>
      </div>
      
      <div class="community-card" data-aos="fade-up" data-aos-delay="300">
        <div class="community-icon"><i class="fas fa-network-wired"></i></div>
        <h3>Network & Connect</h3>
        <p>Build meaningful connections with people who are passionate about the same topics you care about.</p>
      </div>
    </div>
  </div>
</section>


<!-- Footer -->
<footer class="site-footer">
  <div class="container">
    <div class="footer-grid">
      <div class="footer-brand">
        <h3>Healthy Mentoring</h3>
        <p>A marketplace for finding mentors to help you achieve your goals. Create projects, build plans, and get guidance from expert mentors.</p>
        <div class="social-links">
          <a href="#"><i class="fab fa-twitter"></i></a>
          <a href="#"><i class="fab fa-linkedin"></i></a>
          <a href="#"><i class="fab fa-instagram"></i></a>
        </div>
      </div>
      <div class="footer-links">
        <h4>Platform</h4>
        <a href="{% url 'web:mentors' %}">Find Mentor</a>
        <a href="#how-it-works">How It Works</a>
        <a href="#projects-plans">Projects & Plans</a>
        <a href="#communities">Communities</a>
      </div>
      <div class="footer-links">
        <h4>Company</h4>
        <a href="#">About</a>
        <a href="#">Careers</a>
        <a href="#" id="contact-link">Contact</a>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; {% now "Y" %} Healthy Mentoring. All rights reserved.</p>
    </div>
  </div>
</footer>
{% endblock %}

{% block scripts %}
<script src="{% static 'js/landing.js' %}"></script>
<script src="{% static 'js/search-interactions.js' %}"></script>

<!-- Predefined data for filters -->
{{ predefined_categories|json_script:"predefinedCategoriesData" }}
{{ predefined_languages|json_script:"predefinedLanguagesData" }}

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Get predefined data
    const predefinedCategoriesData = document.getElementById('predefinedCategoriesData');
    const predefinedLanguagesData = document.getElementById('predefinedLanguagesData');
    
    const predefinedCategories = predefinedCategoriesData ? JSON.parse(predefinedCategoriesData.textContent) : [];
    const predefinedLanguages = predefinedLanguagesData ? JSON.parse(predefinedLanguagesData.textContent) : [];
    
    // Elements
    const searchInput = document.getElementById('searchInput');
    const clearBtn = document.getElementById('clearBtn');
    const priceSlider = document.getElementById('priceSlider');
    const priceValue = document.getElementById('priceValue');
    const firstSessionFree = document.getElementById('firstSessionFree');
    const firstSessionStatusText = document.getElementById('firstSessionStatusText');
    const firstSessionInfoIcon = document.querySelector('[data-popover="firstSessionFreePopover"]');
    const firstSessionPopover = document.getElementById('firstSessionFreePopover');
    
    // Filter Inputs
    const categoryInput = document.getElementById('categoryInput');
    const categorySuggestions = document.getElementById('categorySuggestions');
    const categoryValue = document.getElementById('categoryValue');
    
    const languageInput = document.getElementById('languageInput');
    const languageSuggestions = document.getElementById('languageSuggestions');
    const languageValue = document.getElementById('languageValue');
    
    // Render flag function - same as in mentors page
    function renderFlag(item) {
        const flagCode = item.flag_code || item.id;
        if (flagCode) {
            return `<span class="fi fi-${flagCode.toLowerCase()}" style="margin-right: 6px; vertical-align: middle;"></span>`;
        } else if (item.flag) {
            return item.flag + ' ';
        }
        return '';
    }
    
    // Autocomplete setup function
    function setupAutocomplete(input, suggestionsContainer, data, valueInput, onSelectCallback) {
        if (!input || !suggestionsContainer) return;
        
        input.addEventListener('input', function() {
            const query = this.value.toLowerCase();
            const matches = data.filter(item => item.name.toLowerCase().includes(query));
            
            suggestionsContainer.innerHTML = '';
            
            if (matches.length > 0) {
                matches.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'suggestion-item';
                    
                    let content = item.name;
                    if (item.flag_code || item.flag) {
                        content = renderFlag(item) + item.name;
                    }
                    
                    div.innerHTML = content;
                    
                    div.addEventListener('click', function() {
                        input.value = item.name;
                        if (valueInput) valueInput.value = item.id;
                        suggestionsContainer.style.display = 'none';
                        if (onSelectCallback) {
                            onSelectCallback();
                        }
                    });
                    suggestionsContainer.appendChild(div);
                });
                suggestionsContainer.style.display = 'block';
                suggestionsContainer.style.maxHeight = '300px';
                suggestionsContainer.style.overflowY = 'auto';
            } else {
                suggestionsContainer.style.display = 'none';
            }
        });
        
        input.addEventListener('focus', function() {
            if (this.value.trim() === '') {
                this.dispatchEvent(new Event('input'));
            }
        });
        
        document.addEventListener('click', function(e) {
            if (!input.contains(e.target) && !suggestionsContainer.contains(e.target)) {
                suggestionsContainer.style.display = 'none';
            }
        });
    }
    
    // Function to update mentors when filters change
    function onFilterChange() {
        loadMentors(true); // Scroll to search section
    }
    
    // Initialize autocompletes with callback
    setupAutocomplete(categoryInput, categorySuggestions, predefinedCategories, categoryValue, onFilterChange);
    setupAutocomplete(languageInput, languageSuggestions, predefinedLanguages, languageValue, onFilterChange);
    
    // Price slider update function
    const updateSlider = function() {
        if (!priceSlider || !priceValue) return;
        const value = parseFloat(priceSlider.value);
        const max = parseFloat(priceSlider.max);
        const min = parseFloat(priceSlider.min);
        const percentage = ((value - min) / (max - min)) * 100;
        
        if (value >= max) {
            priceValue.textContent = '$0 - $200+';
        } else {
            priceValue.textContent = `$0 - $${Math.round(value)}`;
        }
        
        priceSlider.style.background = `linear-gradient(to right, var(--primary) 0%, var(--primary) ${percentage}%, #e2e8f0 ${percentage}%, #e2e8f0 100%)`;
    };
    
    if (priceSlider) {
        setTimeout(updateSlider, 0);
        priceSlider.addEventListener('input', updateSlider);
        window.addEventListener('resize', updateSlider);
    }
    
    // First Session Free toggle
    if (firstSessionFree && firstSessionStatusText) {
        firstSessionFree.addEventListener('change', function() {
            firstSessionStatusText.textContent = this.checked ? 'Enabled' : 'Disabled';
        });
    }
    
    // Popover for First Session Free info icon
    if (firstSessionInfoIcon && firstSessionPopover) {
        let popoverTimeout;

        firstSessionInfoIcon.addEventListener('mouseenter', () => {
            clearTimeout(popoverTimeout);
            firstSessionPopover.style.display = 'block';
            const iconRect = firstSessionInfoIcon.getBoundingClientRect();
            firstSessionPopover.style.left = `${iconRect.left + window.scrollX}px`;
            firstSessionPopover.style.top = `${iconRect.bottom + window.scrollY + 8}px`;
        });

        firstSessionInfoIcon.addEventListener('mouseleave', () => {
            popoverTimeout = setTimeout(() => {
                firstSessionPopover.style.display = 'none';
            }, 100);
        });

        firstSessionPopover.addEventListener('mouseenter', () => {
            clearTimeout(popoverTimeout);
        });

        firstSessionPopover.addEventListener('mouseleave', () => {
            popoverTimeout = setTimeout(() => {
                firstSessionPopover.style.display = 'none';
            }, 100);
        });
    }
    
    // Mentor search suggestions
    const mentorSuggestions = document.getElementById('mentorSuggestions');
    const mentorsContainer = document.getElementById('mentorsContainer');
    let mentorSearchTimer;
    let selectedMentorId = null; // Track if user selected a mentor from suggestions
    
    // Function to search mentors by name
    function searchMentors(query) {
        if (query.length < 2) {
            if (mentorSuggestions) mentorSuggestions.style.display = 'none';
            return;
        }
        
        const searchUrl = "{% url 'web:mentor_search_suggestions' %}";
        fetch(`${searchUrl}?q=${encodeURIComponent(query)}`)
            .then(response => response.json())
            .then(data => {
                displayMentorSuggestions(data.suggestions);
            })
            .catch(error => {
                console.error('Error searching mentors:', error);
                if (mentorSuggestions) mentorSuggestions.style.display = 'none';
            });
    }
    
    // Function to display mentor suggestions
    function displayMentorSuggestions(suggestions) {
        if (!mentorSuggestions) return;
        if (suggestions.length === 0) {
            mentorSuggestions.style.display = 'none';
            return;
        }
        
        mentorSuggestions.innerHTML = '';
        suggestions.forEach((mentor) => {
            const item = document.createElement('div');
            item.className = 'suggestion-item mentor-suggestion-item';
            
            const avatarHtml = mentor.avatar_url 
                ? `<img src="${mentor.avatar_url}" alt="${mentor.name}" style="width: 32px; height: 32px; border-radius: 50%; object-fit: cover;">`
                : `<div style="width: 32px; height: 32px; border-radius: 50%; background: #e2e8f0; display: flex; align-items: center; justify-content: center; color: #94a3b8; font-size: 0.8rem;">${mentor.name.charAt(0)}</div>`;
            
            item.innerHTML = `
                <div style="display: flex; align-items: center; gap: 12px; width: 100%;">
                    ${avatarHtml}
                    <div style="flex: 1; min-width: 0;">
                        <div style="font-weight: 600; color: var(--text-dark); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${mentor.name}</div>
                        <div style="font-size: 0.85rem; color: var(--text-light); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${mentor.mentor_type}</div>
                    </div>
                </div>
            `;
            
            item.addEventListener('click', function() {
                // Directly open mentor profile
                window.location.href = `/mentor/${mentor.id}/`;
            });
            
            mentorSuggestions.appendChild(item);
        });
        mentorSuggestions.style.display = 'block';
        mentorSuggestions.style.maxHeight = '300px';
        mentorSuggestions.style.overflowY = 'auto';
    }
    
    // Search input with suggestions
    if (searchInput) {
        searchInput.addEventListener('input', function() {
            const query = this.value.trim();
            if (clearBtn) clearBtn.style.display = query ? 'flex' : 'none';
            
            clearTimeout(mentorSearchTimer);
            selectedMentorId = null; // Reset selection
            
            if (query.length >= 2) {
                mentorSearchTimer = setTimeout(() => {
                    searchMentors(query);
                }, 300);
            } else {
                if (mentorSuggestions) mentorSuggestions.style.display = 'none';
            }
        });
        
        searchInput.addEventListener('focus', function() {
            if (this.value.trim().length >= 2) {
                searchMentors(this.value.trim());
            }
        });
        
        document.addEventListener('click', function(event) {
            if (!searchInput.contains(event.target) && (!mentorSuggestions || !mentorSuggestions.contains(event.target))) {
                if (mentorSuggestions) mentorSuggestions.style.display = 'none';
            }
        });
    }
    
    // Clear button functionality
    if (clearBtn) {
        clearBtn.addEventListener('click', function() {
            if (searchInput) {
                searchInput.value = '';
                this.style.display = 'none';
                if (mentorSuggestions) mentorSuggestions.style.display = 'none';
                selectedMentorId = null;
                loadMentors(); // Reload mentors when cleared
            }
        });
    }
    
    // Function to create mentor card HTML
    function createMentorCard(mentor) {
        const avatarHtml = mentor.profile_picture 
            ? `<img src="${mentor.profile_picture}" alt="${mentor.first_name} ${mentor.last_name}">`
            : `<img src="https://i.pravatar.cc/150?img=${mentor.id}" alt="${mentor.first_name} ${mentor.last_name}">`;
        
        const tagsHtml = mentor.tags && mentor.tags.length > 0
            ? `<div class="mentor-tags">${mentor.tags.slice(0, 5).map(tag => `<span class="mentor-tag">${tag}</span>`).join('')}</div>`
            : '';
        
        const priceHtml = mentor.price_per_hour
            ? `<p class="mentor-price">$${Math.round(mentor.price_per_hour)}<span>/session</span></p>`
            : `<p class="mentor-price">Contact<span> for pricing</span></p>`;
        
        return `
            <div class="mentor-card" data-aos="fade-up">
                <div class="mentor-header-content">
                    <div class="mentor-avatar">
                        ${avatarHtml}
                    </div>
                    <div class="mentor-title">
                        <h4>${mentor.first_name} ${mentor.last_name}</h4>
                        <p class="mentor-specialty">${mentor.mentor_type}</p>
                    </div>
                </div>
                <div class="mentor-details">
                    ${mentor.quote ? `<p class="mentor-motto">"${mentor.quote}"</p>` : ''}
                    ${mentor.bio ? `<p class="mentor-bio">${mentor.bio.length > 150 ? mentor.bio.substring(0, 150) + '...' : mentor.bio}</p>` : ''}
                    ${tagsHtml}
                </div>
                <div class="mentor-footer">
                    ${priceHtml}
                    <a href="/mentor/${mentor.id}/" class="btn-mentor">View Profile <i class="fas fa-arrow-right"></i></a>
                </div>
            </div>
        `;
    }
    
    // Function to load mentors based on filters
    function loadMentors(scrollToSearch = false) {
        const params = new URLSearchParams();
        
        if (searchInput && searchInput.value.trim() && !selectedMentorId) {
            params.append('q', searchInput.value.trim());
        }
        
        if (categoryValue && categoryValue.value) {
            params.append('category', categoryValue.value);
        }
        
        if (priceSlider) {
            const maxPrice = parseFloat(priceSlider.max);
            const currentValue = parseFloat(priceSlider.value);
            if (currentValue < maxPrice) {
                params.append('price', currentValue);
            }
        }
        
        if (languageValue && languageValue.value) {
            params.append('language', languageValue.value);
        }
        
        if (firstSessionFree && firstSessionFree.checked) {
            params.append('first_session_free', 'true');
        }
        
        const loadUrl = "{% url 'web:landing_mentors_load' %}";
        fetch(`${loadUrl}?${params.toString()}`)
            .then(response => response.json())
            .then(data => {
                if (mentorsContainer) {
                    if (data.mentors && data.mentors.length > 0) {
                        mentorsContainer.innerHTML = data.mentors.map(mentor => createMentorCard(mentor)).join('');
                    } else {
                        mentorsContainer.innerHTML = `
                            <div style="grid-column: 1 / -1; text-align: center; padding: 60px 20px;">
                                <p style="font-size: 1.1rem; color: var(--text-light);">No mentors found matching your criteria.</p>
                                <p style="font-size: 0.9rem; color: var(--text-light); margin-top: 8px;">Try adjusting your filters.</p>
                            </div>
                        `;
                    }
                }
                
                // Scroll to search section if requested
                if (scrollToSearch) {
                    const searchSection = document.getElementById('search');
                    if (searchSection) {
                        setTimeout(() => {
                            searchSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }, 100);
                    }
                }
            })
            .catch(error => {
                console.error('Error loading mentors:', error);
            });
    }
    
    // Load mentors on page load
    loadMentors();
    
    // Price slider - update on change
    if (priceSlider) {
        priceSlider.addEventListener('change', function() {
            onFilterChange();
        });
    }
    
    // First Session Free toggle - update on change
    if (firstSessionFree) {
        firstSessionFree.addEventListener('change', function() {
            onFilterChange();
        });
    }
    
    // Redirect to mentors page with filters (when search button is clicked)
    const redirectToMentors = function(e) {
        if (e) e.preventDefault();
        
        // If a mentor was selected from suggestions, don't redirect
        if (selectedMentorId) {
            return;
        }
        
        const params = new URLSearchParams();
        
        if (searchInput && searchInput.value.trim()) {
            params.append('q', searchInput.value.trim());
        }
        
        if (categoryValue && categoryValue.value) {
            params.append('category', categoryValue.value);
        }
        
        if (priceSlider) {
            const maxPrice = parseFloat(priceSlider.max);
            const currentValue = parseFloat(priceSlider.value);
            if (currentValue < maxPrice) {
                params.append('price', currentValue);
            }
        }
        
        if (languageValue && languageValue.value) {
            params.append('language', languageValue.value);
        }
        
        if (firstSessionFree && firstSessionFree.checked) {
            params.append('first_session_free', 'true');
        }
        
        window.location.href = "{% url 'web:mentors' %}?" + params.toString();
    };

    const seeMoreBtn = document.getElementById('seeMoreMentorsBtn');
    if (seeMoreBtn) {
        seeMoreBtn.addEventListener('click', redirectToMentors);
    }
    
    const seeMoreBtnLanding = document.getElementById('seeMoreMentorsBtnLanding');
    if (seeMoreBtnLanding) {
        seeMoreBtnLanding.addEventListener('click', redirectToMentors);
    }

    const searchBtn = document.querySelector('.search-btn');
    if (searchBtn) {
        searchBtn.addEventListener('click', redirectToMentors);
    }
    
    if (searchInput) {
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                redirectToMentors(e);
            }
        });
    }
});
</script>
{% endblock %}
