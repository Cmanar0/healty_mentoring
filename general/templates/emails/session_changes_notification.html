{% extends "emails/base.html" %}

{% block title %}Session Changes - Action Required{% endblock %}

{% block content %}
<h1 style="color: #3b82f6; margin-bottom: 8px;">Action Required</h1>
<p class="content-text" style="font-size: 18px; font-weight: 600; color: #111827; margin-bottom: 24px;">
  Session Changes - Please Review (Confirm or Decline)
</p>

<!-- Prominent Action Button - Placed Early to Prevent Truncation -->
<div style="margin: 0 0 32px 0; padding: 24px; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); border-radius: 12px; text-align: center; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);">
  <p style="margin: 0 0 16px; font-size: 18px; font-weight: 700; color: #ffffff;">
    Review Session Changes
  </p>
  <p style="margin: 0 0 20px; font-size: 14px; color: #ffffff; opacity: 0.95;">
    Please review and confirm or decline these changes to proceed.
  </p>
  <a href="{{ action_url }}" style="display: inline-block; padding: 16px 40px; background-color: #ffffff; color: #3b82f6 !important; text-decoration: none; border-radius: 8px; font-weight: 700; font-size: 18px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);">
    Review & Manage Changes →
  </a>
</div>

<p class="content-text">
  Hello,
</p>

<p class="content-text">
  <strong>{{ mentor_name }}</strong> has made changes to your session{% if session_changes|length > 1 %}s{% endif %}. Please review and confirm or decline these changes.
</p>

{% for change in session_changes %}
<div style="margin: 24px 0; padding: 0; border-radius: 12px; overflow: hidden; border: 1px solid #e5e7eb;">
  <!-- Session Header -->
  <div style="background-color: #f8fafc; padding: 16px 20px; border-bottom: 1px solid #e5e7eb;">
    <h3 style="margin: 0; font-size: 18px; font-weight: 700; color: #111827;">Session #{{ change.session.id }}</h3>
  </div>
  
  <!-- Changes Content -->
  <div style="padding: 20px; background-color: #ffffff;">
    {% with original_data=change.original_data %}
    {% if original_data %}
      {% if original_data.start_datetime %}
      <!-- Date & Time Change -->
      <div style="margin-bottom: 20px;">
        <div style="font-size: 13px; font-weight: 600; color: #64748b; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;">Date & Time</div>
        
        <table role="presentation" cellpadding="0" cellspacing="0" border="0" style="width: 100%; border-collapse: separate; border-spacing: 0;">
          <tr>
            <td style="padding: 10px 12px; background-color: #fee2e2; border-left: 3px solid #ef4444; border-radius: 8px 0 0 8px; width: 45%;">
              <div style="font-size: 11px; font-weight: 600; color: #991b1b; margin-bottom: 4px; text-transform: uppercase;">Previous</div>
              <div style="font-size: 14px; font-weight: 600; color: #991b1b;">
                {% if original_data.start_datetime|date:"Y-m-d" == original_data.end_datetime|date:"Y-m-d" %}
                  {{ original_data.start_datetime|date:"M d, Y" }}<br>
                  {{ original_data.start_datetime|date:"g:i A" }} - {{ original_data.end_datetime|date:"g:i A" }}
                {% else %}
                  {{ original_data.start_datetime|date:"M d, Y • g:i A" }}<br>
                  {{ original_data.end_datetime|date:"M d, Y • g:i A" }}
                {% endif %}
              </div>
            </td>
            <td style="padding: 10px; text-align: center; vertical-align: middle; background-color: #f9fafb; width: 10%;">
              <div style="color: #64748b; font-size: 16px; font-weight: bold;">→</div>
            </td>
            <td style="padding: 10px 12px; background-color: #dcfce7; border-right: 3px solid #10b981; border-radius: 0 8px 8px 0; width: 45%;">
              <div style="font-size: 11px; font-weight: 600; color: #166534; margin-bottom: 4px; text-transform: uppercase;">Updated</div>
              <div style="font-size: 14px; font-weight: 600; color: #166534;">
                {{ change.session.start_datetime|date:"M d, Y" }}<br>
                {{ change.session.start_datetime|date:"g:i A" }} - {{ change.session.end_datetime|date:"g:i A" }}
              </div>
            </td>
          </tr>
        </table>
      </div>
      {% endif %}
      
      {% if original_data.session_price != change.session.session_price %}
      <!-- Price Change -->
      <div style="margin-bottom: 20px;">
        <div style="font-size: 13px; font-weight: 600; color: #64748b; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;">Price</div>
        
        <table role="presentation" cellpadding="0" cellspacing="0" border="0" style="width: 100%; border-collapse: separate; border-spacing: 0;">
          <tr>
            <td style="padding: 10px 12px; background-color: #fee2e2; border-left: 3px solid #ef4444; border-radius: 8px 0 0 8px; width: 45%;">
              <div style="font-size: 11px; font-weight: 600; color: #991b1b; margin-bottom: 4px; text-transform: uppercase;">Previous</div>
              <div style="font-size: 16px; font-weight: 600; color: #991b1b;">
                ${{ original_data.session_price|default:"Free" }}
              </div>
            </td>
            <td style="padding: 10px; text-align: center; vertical-align: middle; background-color: #f9fafb; width: 10%;">
              <div style="color: #64748b; font-size: 16px; font-weight: bold;">→</div>
            </td>
            <td style="padding: 10px 12px; background-color: #dcfce7; border-right: 3px solid #10b981; border-radius: 0 8px 8px 0; width: 45%;">
              <div style="font-size: 11px; font-weight: 600; color: #166534; margin-bottom: 4px; text-transform: uppercase;">Updated</div>
              <div style="font-size: 16px; font-weight: 600; color: #166534;">
                ${{ change.session.session_price|default:"Free" }}
              </div>
            </td>
          </tr>
        </table>
      </div>
      {% endif %}
    {% endif %}
    {% endwith %}
  </div>
</div>
{% endfor %}

<p class="content-text" style="font-size: 14px; color: #6b7280; margin-top: 32px; padding-top: 24px; border-top: 1px solid #e5e7eb;">
  <strong>Note:</strong> This link will work multiple times. Click it to review all your session invitations and changes, then confirm or decline each one.
</p>
{% endblock %}
