{% extends "base.html" %}
{% load static %}

{% block title %}{% block page_title %}User Dashboard{% endblock %}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
{% endblock %}

{% block navbar %}
<header class="dashboard-header">
  <nav class="dashboard-top-nav">
    <div class="dashboard-nav-left">
      <button class="hamburger-toggle" id="hamburgerToggle" aria-label="Toggle menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <a href="{% url 'web:landing' %}" class="dashboard-logo-link">
        <img src="{% static 'images/logo.png' %}" alt="logo" class="logo">
        <span class="dashboard-brand-text">Healthy Mentoring</span>
      </a>
    </div>
    <div class="dashboard-top-actions">
      {% if user.is_authenticated and user.profile.first_name and user.profile.last_name %}
        <div class="user-profile-dropdown">
          <button class="user-profile-trigger" id="userProfileTrigger">
            <span class="user-name">{{ user.profile.first_name }} {{ user.profile.last_name }}</span>
            <div class="user-avatar">
              {% if user.profile.profile_picture %}
                <img src="{{ user.profile.profile_picture.url }}" alt="{{ user.profile.first_name }}">
              {% else %}
                <div class="avatar-placeholder">
                  <i class="fas fa-user"></i>
                </div>
              {% endif %}
            </div>
          </button>
          <div class="user-dropdown-menu" id="userDropdownMenu">
            <a href="/dashboard/user/account/" class="dropdown-item">
              <i class="fas fa-user"></i>
              <span>Account</span>
            </a>
            <a href="#" class="dropdown-item">
              <i class="fas fa-cog"></i>
              <span>Settings</span>
            </a>
            <a href="#" class="dropdown-item">
              <i class="fas fa-credit-card"></i>
              <span>Subscription</span>
            </a>
            <a href="#" class="dropdown-item">
              <i class="fas fa-headset"></i>
              <span>Support</span>
            </a>
            <div class="dropdown-divider"></div>
            <form action="{% url 'accounts:logout' %}" method="post" class="dropdown-item-form">
              {% csrf_token %}
              <button type="submit" class="dropdown-item logout-item">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
              </button>
            </form>
          </div>
        </div>
      {% endif %}
    </div>
  </nav>
</header>
{% endblock %}

{% block content %}
<div class="dashboard-layout">
  <!-- Left Sidebar -->
  <aside class="dashboard-sidebar" id="dashboardSidebar">
    <nav class="sidebar-nav">
      <ul class="sidebar-menu">
        <li>
          <a href="/dashboard/user/" class="sidebar-link {% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}" title="Dashboard">
            <i class="fas fa-home"></i>
            <span class="sidebar-text">Dashboard</span>
          </a>
        </li>
        <li>
          <a href="{% url 'web:mentors' %}" class="sidebar-link" title="Find Mentors">
            <i class="fas fa-search"></i>
            <span class="sidebar-text">Find Mentors</span>
          </a>
        </li>
        <li>
          <a href="/dashboard/user/my-sessions/" class="sidebar-link {% if request.resolver_match.url_name == 'my_sessions' %}active{% endif %}" title="My Sessions">
            <i class="fas fa-calendar"></i>
            <span class="sidebar-text">My Sessions</span>
          </a>
        </li>
      </ul>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="dashboard-main" id="dashboardMain">
    {% block dashboard_content %}{% endblock %}
  </main>
</div>
{% endblock %}

{% block scripts %}
{{ block.super }}
<style>
:root {
  --primary: #10b981;
  --text-dark: #1e293b;
  --text-light: #94a3b8;
}

/* Hamburger hover - green bars, no background */
.hamburger-toggle:hover {
  background: transparent;
}

.hamburger-toggle:hover span {
  background: var(--primary);
}

/* User Profile Dropdown */
.user-profile-dropdown {
  position: relative;
}

.user-profile-trigger {
  display: flex;
  align-items: center;
  gap: 12px;
  background: transparent;
  border: none;
  cursor: pointer;
  padding: 8px 12px;
  border-radius: 8px;
  transition: none;
}

.user-profile-trigger:hover {
  background: transparent;
}

.user-profile-trigger:hover .user-name {
  color: var(--primary);
}

.user-name {
  font-weight: 500;
  color: var(--text-dark);
  font-size: 0.95rem;
  transition: color 0.2s ease;
}

.user-avatar {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  overflow: hidden;
  flex-shrink: 0;
  border: 2px solid var(--primary);
}

.user-avatar img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.avatar-placeholder {
  width: 100%;
  height: 100%;
  background: var(--primary);
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 0.9rem;
}

.user-dropdown-menu {
  position: absolute;
  top: calc(100% + 8px);
  right: 0;
  background: white;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.15);
  min-width: 200px;
  padding: 0;
  opacity: 0;
  visibility: hidden;
  transform: translateY(-10px);
  transition: all 0.2s ease;
  z-index: 1000;
}

.user-profile-dropdown.active .user-dropdown-menu {
  opacity: 1;
  visibility: visible;
  transform: translateY(0);
}

.dropdown-item,
.dropdown-item-form {
  display: block;
  width: 100%;
  text-align: left;
}

.dropdown-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 20px;
  color: var(--text-dark);
  text-decoration: none;
  transition: background 0.2s ease;
  border: none;
  background: transparent;
  width: 100%;
  cursor: pointer;
  font-size: 0.95rem;
}

/* First button - rounded top corners */
.dropdown-item:first-child {
  border-radius: 12px 12px 0 0;
}

.dropdown-item:hover {
  background: rgba(16, 185, 129, 0.1);
  color: var(--primary);
}

/* First button hover - maintain top rounded corners */
.dropdown-item:first-child:hover {
  border-radius: 12px 12px 0 0;
}

.dropdown-item i {
  width: 20px;
  text-align: center;
  color: var(--text-light);
}

.dropdown-item:hover i {
  color: var(--primary);
}

.dropdown-divider {
  height: 1px;
  background: rgba(0,0,0,0.1);
}

.logout-item {
  margin-top: 0;
  border-radius: 0 0 12px 12px;
}

.logout-item:hover {
  border-radius: 0 0 12px 12px;
}

.logout-item i {
  color: #ef4444;
}

.logout-item:hover {
  background: rgba(239, 68, 68, 0.1);
  color: #ef4444;
}

.logout-item:hover i {
  color: #ef4444;
}
</style>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const hamburgerToggle = document.getElementById('hamburgerToggle');
  const sidebar = document.getElementById('dashboardSidebar');
  const dashboardLayout = document.querySelector('.dashboard-layout');

  if (hamburgerToggle && sidebar && dashboardLayout) {
    // Check if sidebar should start collapsed (from localStorage)
    const isCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
    if (isCollapsed) {
      sidebar.classList.add('collapsed');
      dashboardLayout.classList.add('sidebar-collapsed');
      hamburgerToggle.classList.add('active');
    }

    hamburgerToggle.addEventListener('click', function() {
      sidebar.classList.toggle('collapsed');
      dashboardLayout.classList.toggle('sidebar-collapsed');
      hamburgerToggle.classList.toggle('active');
      
      // Save state to localStorage
      localStorage.setItem('sidebarCollapsed', sidebar.classList.contains('collapsed'));
    });

    // Close sidebar when clicking outside on mobile
    if (window.innerWidth <= 768) {
      document.addEventListener('click', function(event) {
        if (!sidebar.contains(event.target) && !hamburgerToggle.contains(event.target)) {
          sidebar.classList.remove('open');
          hamburgerToggle.classList.remove('active');
        }
      });
    }
  }

  // User Profile Dropdown
  const userProfileTrigger = document.getElementById('userProfileTrigger');
  const userDropdownMenu = document.getElementById('userDropdownMenu');
  const userProfileDropdown = document.querySelector('.user-profile-dropdown');

  if (userProfileTrigger && userDropdownMenu) {
    userProfileTrigger.addEventListener('click', function(e) {
      e.stopPropagation();
      userProfileDropdown.classList.toggle('active');
    });

    // Close dropdown when clicking outside
    document.addEventListener('click', function(event) {
      if (userProfileDropdown && !userProfileDropdown.contains(event.target)) {
        userProfileDropdown.classList.remove('active');
      }
    });
  }
});
</script>
{% endblock %}
