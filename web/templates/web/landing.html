{% extends "base.html" %}
{% block title %}Healthy Mentoring — Mentors platform{% endblock %}
{% load static %}

{% block extra_css %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'css/landing.css' %}">
<!-- Flag Icons CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flag-icons@7.0.0/css/flag-icons.min.css">
{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section">
  <div class="container hero-container">
    <div class="hero-text" data-aos="fade-right">
      <span class="badge">Tech-Enhanced Mentoring</span>
      <h1>Find Your Guide.<br><span class="gradient-text">Achieve Your Goals.</span></h1>
      <p>Avoid getting stuck in micro-tracking and planning every little move. Allow your mentor and our AI-powered platform to deal with the time-consuming management of life that unnecessarily steals your energy. Focus on what really matters and achieve your full potential.</p>
      <div class="hero-actions">
        <a href="#search" class="btn btn-primary">Find a Mentor</a>
        <a href="#how-it-works" class="btn btn-outline">How It Works</a>
      </div>
      <div class="hero-stats">
        <div class="stat">
          <span class="stat-number">500+</span>
          <span class="stat-label">Vetted Mentors</span>
        </div>
        <div class="stat">
          <span class="stat-number">100%</span>
          <span class="stat-label">Data-Driven</span>
        </div>
      </div>
    </div>
    <div class="hero-visual" data-aos="fade-left">
      <div class="abstract-shape"></div>
      <div class="glass-card">
        <div class="card-header">
          <div class="avatar"></div>
          <div class="info">
            <div class="name">Your Progress</div>
            <div class="status">On Track ✅</div>
          </div>
        </div>
        <div class="chart-preview">
          <!-- Placeholder for mini chart or visual -->
          <div class="bar" style="height: 40%"></div>
          <div class="bar" style="height: 70%"></div>
          <div class="bar" style="height: 55%"></div>
          <div class="bar active" style="height: 90%"></div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Mentor Search Section -->
<section id="search" class="search-section-new">
  <div class="search-header">
    <h2 class="search-title">Find Your Perfect Mentor</h2>
    <p class="search-subtitle">Browse our curated network of expert mentors across all life areas</p>
    <div class="search-bar-container">
      <div class="search-bar" style="position: relative;">
        <i class="fas fa-search"></i>
        <input type="text" id="searchInput" placeholder="Search for mentors by name, expertise, or keyword..." autocomplete="off">
        <button class="clear-btn" id="clearBtn" style="display: none;">
          <i class="fas fa-times"></i>
        </button>
        <button class="search-btn">Search</button>
        <!-- Mentor suggestions dropdown -->
        <div class="autocomplete-suggestions" id="mentorSuggestions" style="position: absolute; top: 100%; left: 0; right: 0; z-index: 1000; display: none;"></div>
      </div>
    </div>
  </div>
  
  <div class="search-filters">
    <div class="filter-group filter-group-compact">
      <label><i class="fas fa-tag"></i> Category</label>
      <div class="autocomplete-container" style="position: relative;">
        <input type="text" id="categoryInput" class="form-input autocomplete-input" placeholder="Type to search categories..." autocomplete="off">
        <div class="autocomplete-suggestions" id="categorySuggestions"></div>
        <input type="hidden" id="categoryValue">
      </div>
    </div>
    
    <div class="filter-group price-slider-group">
      <label class="price-label">
        <span><i class="fas fa-dollar-sign" style="margin-right: 5px;"></i> Session Price</span>
        <span class="price-value" id="priceValue">$0 - ${{ max_price|default:200 }}</span>
      </label>
      <div class="price-slider-wrapper">
        <input type="range" min="{{ min_price|default:0 }}" max="{{ max_price|default:200 }}" value="{{ max_price|default:200 }}" class="price-slider" id="priceSlider">
      </div>
    </div>
    
    <div class="filter-group filter-group-compact">
      <label><i class="fas fa-globe"></i> Language</label>
      <div class="autocomplete-container" style="position: relative;">
        <input type="text" id="languageInput" class="form-input autocomplete-input" placeholder="Type to search languages..." autocomplete="off">
        <div class="autocomplete-suggestions" id="languageSuggestions"></div>
        <input type="hidden" id="languageValue">
      </div>
    </div>
    
    <div class="filter-group filter-group-compact">
      <label>
        <i class="fas fa-gift"></i> First Session Free
        <span class="info-icon-popover-trigger" data-popover="firstSessionFreePopover">
          <i class="fas fa-info-circle" style="color: var(--text-light); font-size: 0.85rem; margin-left: 4px; cursor: help;"></i>
        </span>
        <div class="info-popover" id="firstSessionFreePopover" style="display: none;">
          Show only mentors offering free first session
        </div>
      </label>
      <div style="display: flex; align-items: center; gap: 12px; margin-top: 8px;">
        <div class="toggle-wrapper">
          <label class="toggle-switch">
            <input type="checkbox" id="firstSessionFree">
            <span class="toggle-slider"></span>
          </label>
          <span class="toggle-status-text" id="firstSessionStatusText">Disabled</span>
        </div>
      </div>
    </div>
  </div>
  
  <div class="mentors-container" id="mentorsContainer">
    <!-- Mentor cards will be loaded dynamically -->
  </div>
  
  <div class="text-center" style="margin-top: 40px; padding: 0 20px;">
    <a href="#" id="seeMoreMentorsBtnLanding" class="btn btn-primary btn-lg" style="background-color: #3b82f6; padding: 16px 30px;">See More Mentors <i class="fas fa-arrow-right ml-2"></i></a>
  </div>

</section>

<!-- How It Works (The Journey) -->
<section id="how-it-works" class="journey-section">
  <div class="container">
    <div class="section-header text-center" data-aos="fade-up">
      <span class="badge">The Process</span>
      <h2>Your Path to Success</h2>
      <p>A seamless, tech-enabled journey from your first click to your daily wins.</p>
    </div>
    
    <div class="timeline">
      <!-- Step 1 -->
      <div class="timeline-item" data-aos="fade-right">
        <div class="timeline-icon"><i class="fas fa-search"></i></div>
        <div class="timeline-content">
          <h3>1. Find Your Guide</h3>
          <p>Browse our curated list of expert mentors. Filter by specialization, language, and price to find the perfect match for your goals.</p>
        </div>
      </div>

      <!-- Step 2 -->
      <div class="timeline-item right" data-aos="fade-left">
        <div class="timeline-icon"><i class="fas fa-calendar-check"></i></div>
        <div class="timeline-content">
          <h3>2. The Setup</h3>
          <p>Schedule your first session. Fill out a smart intake form so your mentor knows exactly what you need before you even meet. Pay securely for just one session—no commitments yet.</p>
        </div>
      </div>

      <!-- Step 3 -->
      <div class="timeline-item" data-aos="fade-right">
        <div class="timeline-icon"><i class="fas fa-video"></i></div>
        <div class="timeline-content">
          <h3>3. The Blueprint Session</h3>
          <p>Meet your mentor. Define your vision, set concrete goals, and create a roadmap. It's not just a chat; it's a strategy session.</p>
        </div>
      </div>

      <!-- Step 4 -->
      <div class="timeline-item right" data-aos="fade-left">
        <div class="timeline-icon"><i class="fas fa-envelope-open-text"></i></div>
        <div class="timeline-content">
          <h3>4. The Decision</h3>
          <p>Receive a post-session summary and a personalized feedback email. If you click, you'll get an exclusive discount to continue the journey.</p>
        </div>
      </div>

      <!-- Step 5 -->
      <div class="timeline-item" data-aos="fade-right">
        <div class="timeline-icon"><i class="fas fa-user-plus"></i></div>
        <div class="timeline-content">
          <h3>5. Unlock the Platform</h3>
          <p>Register and link your account. You now have a digital HQ for your growth, with multiple mentors if you choose.</p>
        </div>
      </div>

      <!-- Step 6 -->
      <div class="timeline-item right" data-aos="fade-left">
        <div class="timeline-icon"><i class="fas fa-mobile-alt"></i></div>
        <div class="timeline-content">
          <h3>6. Accountability on Autopilot</h3>
          <p>Download the app. Track tasks, get reminders, and let your mentor see your progress in real-time. It's like having a coach in your pocket.</p>
        </div>
      </div>
    </div>

    <div class="text-center mt-5" data-aos="fade-up">
      <a href="{% url 'web:mentors' %}" id="seeMoreMentorsBtn" class="btn btn-primary btn-lg" style="padding: 16px 30px;">Find your mentor <i class="fas fa-arrow-right ml-2"></i></a>
    </div>
  </div>
</section>

<!-- The "Wheel of Life" Interactive Section -->
<section id="features" class="radar-section">
  <div class="container">
    <div class="section-header text-center" data-aos="fade-up">
      <h2>Mentoring, Upgrade.</h2>
      <p>Forget messy notes and forgotten goals. Our platform tracks everything for you.</p>
    </div>
    <div class="radar-container" data-aos="zoom-in">
      <div class="radar-chart-wrapper">
        <canvas id="lifeBalanceChart"></canvas>
      </div>
      <div class="radar-text">
        <h3>Data-Driven Growth</h3>
        <p>Your mentor gets a real-time view of your progress across all life areas. We track tasks, habits, and goals so every session is focused on what matters most.</p>
        <ul class="feature-list">
          <li>
            <i class="fas fa-check-circle"></i>
            <div class="feature-content">
              <strong>Seamless Sync</strong>
              <span>Meetings & tasks auto-synced to your calendar.</span>
            </div>
          </li>
          <li>
            <i class="fas fa-check-circle"></i>
            <div class="feature-content">
              <strong>AI Summaries</strong>
              <span>Never miss a key insight from your sessions.</span>
            </div>
          </li>
          <li>
            <i class="fas fa-check-circle"></i>
            <div class="feature-content">
              <strong>Holistic View</strong>
              <span>Balance Health, Wealth, and Happiness.</span>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </div>
</section>

<!-- Business Lab (Dark Mode) -->
<section id="business-lab" class="business-section">
  <div class="container">
    <div class="section-header text-center light-text" data-aos="fade-up">
      <span class="badge badge-dark">For Entrepreneurs</span>
      <h2>Build With Confidence</h2>
      <p>Work with business mentors who have access to powerful AI tools to validate your ideas.</p>
    </div>
    <div class="business-features">
      <!-- Feature 1: Financial Modeling -->
      <div class="business-feature-row" data-aos="fade-up">
        <div class="feature-text">
          <div class="icon-box"><i class="fas fa-chart-line"></i></div>
          <h3>Financial Modeling</h3>
          <p><strong>Stop burning capital on guesswork.</strong> Our tools analyze your revenue streams to spot leaks and identify profit opportunities. For startups, we stress-test your financial model to ensure viability before launch—helping you pivot early and build a plan that investors trust.</p>
        </div>
        <div class="feature-visual">
          <img src="{% static 'images/subsec1.png' %}" alt="Financial Dashboard" class="feature-img">
        </div>
      </div>

      <!-- Feature 2: Idea Validation -->
      <div class="business-feature-row reverse" data-aos="fade-up">
        <div class="feature-text">
          <div class="icon-box"><i class="fas fa-lightbulb"></i></div>
          <h3>Idea Validation</h3>
          <p><strong>Don't build in the dark.</strong> Validate your concept with real market data. Your mentor will help you generate professional landing pages to test your value proposition against actual traffic. Get the hard numbers you need to prove your idea works before you commit.</p>
        </div>
        <div class="feature-visual">
          <img src="{% static 'images/subsec2.png' %}" alt="Landing Page Generator" class="feature-img">
        </div>
      </div>

      <!-- Feature 3: Growth Strategy -->
      <div class="business-feature-row" data-aos="fade-up">
        <div class="feature-text">
          <div class="icon-box"><i class="fas fa-bullhorn"></i></div>
          <h3>Growth Strategy</h3>
          <p><strong>Turn data into dominance.</strong> We combine your financial models with real-world market feedback to create a bulletproof growth strategy. Whether you're fixing a stalled business or pitching a new venture, you'll have a data-backed roadmap that shows exactly how to scale.</p>
        </div>
        <div class="feature-visual">
          <img src="{% static 'images/subsec3.png' %}" alt="Growth Roadmap" class="feature-img">
        </div>
      </div>

      <!-- Feature 4: Solo Tools -->
      <div class="business-feature-row solo-tools-row" data-aos="fade-up">
        <div class="feature-text solo-tools-text">
          <div class="icon-box"><i class="fas fa-tools"></i></div>
          <h3>Prefer to Fly Solo?</h3>
          <p>Access our AI-powered business tools without committing to a mentor. Validate, model, and plan on your own terms.</p>
          <a href="#" class="btn btn-solo-tools">Explore the Toolkit <i class="fas fa-arrow-right"></i></a>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Footer -->
<footer class="site-footer">
  <div class="container">
    <div class="footer-grid">
      <div class="footer-brand">
        <h3>Healthy Mentoring</h3>
        <p>A data-driven platform with a holistic approach—real human connection, powered by AI.</p>
        <div class="social-links">
          <a href="#"><i class="fab fa-twitter"></i></a>
          <a href="#"><i class="fab fa-linkedin"></i></a>
          <a href="#"><i class="fab fa-instagram"></i></a>
        </div>
      </div>
      <div class="footer-links">
        <h4>Platform</h4>
        <a href="{% url 'web:mentors' %}">Mentors</a>
        <a href="#business-lab">Business Lab</a>
        <a href="#">Pricing</a>
      </div>
      <div class="footer-links">
        <h4>Company</h4>
        <a href="#">About</a>
        <a href="#">Careers</a>
        <a href="#" id="contact-link">Contact</a>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; {% now "Y" %} Healthy Mentoring. All rights reserved.</p>
    </div>
  </div>
</footer>
{% endblock %}

{% block scripts %}
<script src="{% static 'js/landing.js' %}"></script>
<script src="{% static 'js/search-interactions.js' %}"></script>

<!-- Predefined data for filters -->
{{ predefined_categories|json_script:"predefinedCategoriesData" }}
{{ predefined_languages|json_script:"predefinedLanguagesData" }}

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Get predefined data
    const predefinedCategoriesData = document.getElementById('predefinedCategoriesData');
    const predefinedLanguagesData = document.getElementById('predefinedLanguagesData');
    
    const predefinedCategories = predefinedCategoriesData ? JSON.parse(predefinedCategoriesData.textContent) : [];
    const predefinedLanguages = predefinedLanguagesData ? JSON.parse(predefinedLanguagesData.textContent) : [];
    
    // Elements
    const searchInput = document.getElementById('searchInput');
    const clearBtn = document.getElementById('clearBtn');
    const priceSlider = document.getElementById('priceSlider');
    const priceValue = document.getElementById('priceValue');
    const firstSessionFree = document.getElementById('firstSessionFree');
    const firstSessionStatusText = document.getElementById('firstSessionStatusText');
    const firstSessionInfoIcon = document.querySelector('[data-popover="firstSessionFreePopover"]');
    const firstSessionPopover = document.getElementById('firstSessionFreePopover');
    
    // Filter Inputs
    const categoryInput = document.getElementById('categoryInput');
    const categorySuggestions = document.getElementById('categorySuggestions');
    const categoryValue = document.getElementById('categoryValue');
    
    const languageInput = document.getElementById('languageInput');
    const languageSuggestions = document.getElementById('languageSuggestions');
    const languageValue = document.getElementById('languageValue');
    
    // Render flag function - same as in mentors page
    function renderFlag(item) {
        const flagCode = item.flag_code || item.id;
        if (flagCode) {
            return `<span class="fi fi-${flagCode.toLowerCase()}" style="margin-right: 6px; vertical-align: middle;"></span>`;
        } else if (item.flag) {
            return item.flag + ' ';
        }
        return '';
    }
    
    // Autocomplete setup function
    function setupAutocomplete(input, suggestionsContainer, data, valueInput, onSelectCallback) {
        if (!input || !suggestionsContainer) return;
        
        input.addEventListener('input', function() {
            const query = this.value.toLowerCase();
            const matches = data.filter(item => item.name.toLowerCase().includes(query));
            
            suggestionsContainer.innerHTML = '';
            
            if (matches.length > 0) {
                matches.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'suggestion-item';
                    
                    let content = item.name;
                    if (item.flag_code || item.flag) {
                        content = renderFlag(item) + item.name;
                    }
                    
                    div.innerHTML = content;
                    
                    div.addEventListener('click', function() {
                        input.value = item.name;
                        if (valueInput) valueInput.value = item.id;
                        suggestionsContainer.style.display = 'none';
                        if (onSelectCallback) {
                            onSelectCallback();
                        }
                    });
                    suggestionsContainer.appendChild(div);
                });
                suggestionsContainer.style.display = 'block';
                suggestionsContainer.style.maxHeight = '300px';
                suggestionsContainer.style.overflowY = 'auto';
            } else {
                suggestionsContainer.style.display = 'none';
            }
        });
        
        input.addEventListener('focus', function() {
            if (this.value.trim() === '') {
                this.dispatchEvent(new Event('input'));
            }
        });
        
        document.addEventListener('click', function(e) {
            if (!input.contains(e.target) && !suggestionsContainer.contains(e.target)) {
                suggestionsContainer.style.display = 'none';
            }
        });
    }
    
    // Function to update mentors when filters change
    function onFilterChange() {
        loadMentors(true); // Scroll to search section
    }
    
    // Initialize autocompletes with callback
    setupAutocomplete(categoryInput, categorySuggestions, predefinedCategories, categoryValue, onFilterChange);
    setupAutocomplete(languageInput, languageSuggestions, predefinedLanguages, languageValue, onFilterChange);
    
    // Price slider update function
    const updateSlider = function() {
        if (!priceSlider || !priceValue) return;
        const value = parseFloat(priceSlider.value);
        const max = parseFloat(priceSlider.max);
        const min = parseFloat(priceSlider.min);
        const percentage = ((value - min) / (max - min)) * 100;
        
        if (value >= max) {
            priceValue.textContent = '$0 - $200+';
        } else {
            priceValue.textContent = `$0 - $${Math.round(value)}`;
        }
        
        priceSlider.style.background = `linear-gradient(to right, var(--primary) 0%, var(--primary) ${percentage}%, #e2e8f0 ${percentage}%, #e2e8f0 100%)`;
    };
    
    if (priceSlider) {
        setTimeout(updateSlider, 0);
        priceSlider.addEventListener('input', updateSlider);
        window.addEventListener('resize', updateSlider);
    }
    
    // First Session Free toggle
    if (firstSessionFree && firstSessionStatusText) {
        firstSessionFree.addEventListener('change', function() {
            firstSessionStatusText.textContent = this.checked ? 'Enabled' : 'Disabled';
        });
    }
    
    // Popover for First Session Free info icon
    if (firstSessionInfoIcon && firstSessionPopover) {
        let popoverTimeout;

        firstSessionInfoIcon.addEventListener('mouseenter', () => {
            clearTimeout(popoverTimeout);
            firstSessionPopover.style.display = 'block';
            const iconRect = firstSessionInfoIcon.getBoundingClientRect();
            firstSessionPopover.style.left = `${iconRect.left + window.scrollX}px`;
            firstSessionPopover.style.top = `${iconRect.bottom + window.scrollY + 8}px`;
        });

        firstSessionInfoIcon.addEventListener('mouseleave', () => {
            popoverTimeout = setTimeout(() => {
                firstSessionPopover.style.display = 'none';
            }, 100);
        });

        firstSessionPopover.addEventListener('mouseenter', () => {
            clearTimeout(popoverTimeout);
        });

        firstSessionPopover.addEventListener('mouseleave', () => {
            popoverTimeout = setTimeout(() => {
                firstSessionPopover.style.display = 'none';
            }, 100);
        });
    }
    
    // Mentor search suggestions
    const mentorSuggestions = document.getElementById('mentorSuggestions');
    const mentorsContainer = document.getElementById('mentorsContainer');
    let mentorSearchTimer;
    let selectedMentorId = null; // Track if user selected a mentor from suggestions
    
    // Function to search mentors by name
    function searchMentors(query) {
        if (query.length < 2) {
            if (mentorSuggestions) mentorSuggestions.style.display = 'none';
            return;
        }
        
        const searchUrl = "{% url 'web:mentor_search_suggestions' %}";
        fetch(`${searchUrl}?q=${encodeURIComponent(query)}`)
            .then(response => response.json())
            .then(data => {
                displayMentorSuggestions(data.suggestions);
            })
            .catch(error => {
                console.error('Error searching mentors:', error);
                if (mentorSuggestions) mentorSuggestions.style.display = 'none';
            });
    }
    
    // Function to display mentor suggestions
    function displayMentorSuggestions(suggestions) {
        if (!mentorSuggestions) return;
        if (suggestions.length === 0) {
            mentorSuggestions.style.display = 'none';
            return;
        }
        
        mentorSuggestions.innerHTML = '';
        suggestions.forEach((mentor) => {
            const item = document.createElement('div');
            item.className = 'suggestion-item mentor-suggestion-item';
            
            const avatarHtml = mentor.avatar_url 
                ? `<img src="${mentor.avatar_url}" alt="${mentor.name}" style="width: 32px; height: 32px; border-radius: 50%; object-fit: cover;">`
                : `<div style="width: 32px; height: 32px; border-radius: 50%; background: #e2e8f0; display: flex; align-items: center; justify-content: center; color: #94a3b8; font-size: 0.8rem;">${mentor.name.charAt(0)}</div>`;
            
            item.innerHTML = `
                <div style="display: flex; align-items: center; gap: 12px; width: 100%;">
                    ${avatarHtml}
                    <div style="flex: 1; min-width: 0;">
                        <div style="font-weight: 600; color: var(--text-dark); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${mentor.name}</div>
                        <div style="font-size: 0.85rem; color: var(--text-light); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${mentor.mentor_type}</div>
                    </div>
                </div>
            `;
            
            item.addEventListener('click', function() {
                // Directly open mentor profile
                window.location.href = `/mentor/${mentor.id}/`;
            });
            
            mentorSuggestions.appendChild(item);
        });
        mentorSuggestions.style.display = 'block';
        mentorSuggestions.style.maxHeight = '300px';
        mentorSuggestions.style.overflowY = 'auto';
    }
    
    // Search input with suggestions
    if (searchInput) {
        searchInput.addEventListener('input', function() {
            const query = this.value.trim();
            if (clearBtn) clearBtn.style.display = query ? 'flex' : 'none';
            
            clearTimeout(mentorSearchTimer);
            selectedMentorId = null; // Reset selection
            
            if (query.length >= 2) {
                mentorSearchTimer = setTimeout(() => {
                    searchMentors(query);
                }, 300);
            } else {
                if (mentorSuggestions) mentorSuggestions.style.display = 'none';
            }
        });
        
        searchInput.addEventListener('focus', function() {
            if (this.value.trim().length >= 2) {
                searchMentors(this.value.trim());
            }
        });
        
        document.addEventListener('click', function(event) {
            if (!searchInput.contains(event.target) && (!mentorSuggestions || !mentorSuggestions.contains(event.target))) {
                if (mentorSuggestions) mentorSuggestions.style.display = 'none';
            }
        });
    }
    
    // Clear button functionality
    if (clearBtn) {
        clearBtn.addEventListener('click', function() {
            if (searchInput) {
                searchInput.value = '';
                this.style.display = 'none';
                if (mentorSuggestions) mentorSuggestions.style.display = 'none';
                selectedMentorId = null;
                loadMentors(); // Reload mentors when cleared
            }
        });
    }
    
    // Function to create mentor card HTML
    function createMentorCard(mentor) {
        const avatarHtml = mentor.profile_picture 
            ? `<img src="${mentor.profile_picture}" alt="${mentor.first_name} ${mentor.last_name}">`
            : `<img src="https://i.pravatar.cc/150?img=${mentor.id}" alt="${mentor.first_name} ${mentor.last_name}">`;
        
        const tagsHtml = mentor.tags && mentor.tags.length > 0
            ? `<div class="mentor-tags">${mentor.tags.slice(0, 5).map(tag => `<span class="mentor-tag">${tag}</span>`).join('')}</div>`
            : '';
        
        const priceHtml = mentor.price_per_hour
            ? `<p class="mentor-price">$${Math.round(mentor.price_per_hour)}<span>/session</span></p>`
            : `<p class="mentor-price">Contact<span> for pricing</span></p>`;
        
        return `
            <div class="mentor-card" data-aos="fade-up">
                <div class="mentor-header-content">
                    <div class="mentor-avatar">
                        ${avatarHtml}
                    </div>
                    <div class="mentor-title">
                        <h4>${mentor.first_name} ${mentor.last_name}</h4>
                        <p class="mentor-specialty">${mentor.mentor_type}</p>
                    </div>
                </div>
                <div class="mentor-details">
                    ${mentor.quote ? `<p class="mentor-motto">"${mentor.quote}"</p>` : ''}
                    ${mentor.bio ? `<p class="mentor-bio">${mentor.bio.length > 150 ? mentor.bio.substring(0, 150) + '...' : mentor.bio}</p>` : ''}
                    ${tagsHtml}
                </div>
                <div class="mentor-footer">
                    ${priceHtml}
                    <a href="/mentor/${mentor.id}/" class="btn-mentor">View Profile <i class="fas fa-arrow-right"></i></a>
                </div>
            </div>
        `;
    }
    
    // Function to load mentors based on filters
    function loadMentors(scrollToSearch = false) {
        const params = new URLSearchParams();
        
        if (searchInput && searchInput.value.trim() && !selectedMentorId) {
            params.append('q', searchInput.value.trim());
        }
        
        if (categoryValue && categoryValue.value) {
            params.append('category', categoryValue.value);
        }
        
        if (priceSlider) {
            const maxPrice = parseFloat(priceSlider.max);
            const currentValue = parseFloat(priceSlider.value);
            if (currentValue < maxPrice) {
                params.append('price', currentValue);
            }
        }
        
        if (languageValue && languageValue.value) {
            params.append('language', languageValue.value);
        }
        
        if (firstSessionFree && firstSessionFree.checked) {
            params.append('first_session_free', 'true');
        }
        
        const loadUrl = "{% url 'web:landing_mentors_load' %}";
        fetch(`${loadUrl}?${params.toString()}`)
            .then(response => response.json())
            .then(data => {
                if (mentorsContainer) {
                    if (data.mentors && data.mentors.length > 0) {
                        mentorsContainer.innerHTML = data.mentors.map(mentor => createMentorCard(mentor)).join('');
                    } else {
                        mentorsContainer.innerHTML = `
                            <div style="grid-column: 1 / -1; text-align: center; padding: 60px 20px;">
                                <p style="font-size: 1.1rem; color: var(--text-light);">No mentors found matching your criteria.</p>
                                <p style="font-size: 0.9rem; color: var(--text-light); margin-top: 8px;">Try adjusting your filters.</p>
                            </div>
                        `;
                    }
                }
                
                // Scroll to search section if requested
                if (scrollToSearch) {
                    const searchSection = document.getElementById('search');
                    if (searchSection) {
                        setTimeout(() => {
                            searchSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }, 100);
                    }
                }
            })
            .catch(error => {
                console.error('Error loading mentors:', error);
            });
    }
    
    // Load mentors on page load
    loadMentors();
    
    // Price slider - update on change
    if (priceSlider) {
        priceSlider.addEventListener('change', function() {
            onFilterChange();
        });
    }
    
    // First Session Free toggle - update on change
    if (firstSessionFree) {
        firstSessionFree.addEventListener('change', function() {
            onFilterChange();
        });
    }
    
    // Redirect to mentors page with filters (when search button is clicked)
    const redirectToMentors = function(e) {
        if (e) e.preventDefault();
        
        // If a mentor was selected from suggestions, don't redirect
        if (selectedMentorId) {
            return;
        }
        
        const params = new URLSearchParams();
        
        if (searchInput && searchInput.value.trim()) {
            params.append('q', searchInput.value.trim());
        }
        
        if (categoryValue && categoryValue.value) {
            params.append('category', categoryValue.value);
        }
        
        if (priceSlider) {
            const maxPrice = parseFloat(priceSlider.max);
            const currentValue = parseFloat(priceSlider.value);
            if (currentValue < maxPrice) {
                params.append('price', currentValue);
            }
        }
        
        if (languageValue && languageValue.value) {
            params.append('language', languageValue.value);
        }
        
        if (firstSessionFree && firstSessionFree.checked) {
            params.append('first_session_free', 'true');
        }
        
        window.location.href = "{% url 'web:mentors' %}?" + params.toString();
    };

    const seeMoreBtn = document.getElementById('seeMoreMentorsBtn');
    if (seeMoreBtn) {
        seeMoreBtn.addEventListener('click', redirectToMentors);
    }
    
    const seeMoreBtnLanding = document.getElementById('seeMoreMentorsBtnLanding');
    if (seeMoreBtnLanding) {
        seeMoreBtnLanding.addEventListener('click', redirectToMentors);
    }

    const searchBtn = document.querySelector('.search-btn');
    if (searchBtn) {
        searchBtn.addEventListener('click', redirectToMentors);
    }
    
    if (searchInput) {
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                redirectToMentors(e);
            }
        });
    }
});
</script>
{% endblock %}
